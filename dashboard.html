<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>TrataSoft Dashboard</title>
<style>
  /* ===== Global ===== */
  * { box-sizing: border-box; margin:0; padding:0; font-family: 'Segoe UI', sans-serif; }
  body { background:#f4f6f9; color:#333; }

  a { color:#1d3557; text-decoration:none; }
  a:hover { text-decoration:underline; }

  /* ===== Dashboard Layout ===== */
  #dashboard { display:flex; height:100vh; }

  /* Sidebar */
  .sidebar {
    width:220px; background:#1d3557; color:white; padding:20px 10px; display:flex; flex-direction:column;
  }
  .sidebar h2 { text-align:center; margin-bottom:30px; font-size:1.5em; }
  .sidebar ul { list-style:none; }
  .sidebar li {
    padding:10px 15px; margin-bottom:10px; cursor:pointer; border-radius:5px;
    transition: background 0.2s;
  }
  .sidebar li:hover, .sidebar li.active { background:#457b9d; }

  /* Main Content */
  .main { flex:1; display:flex; flex-direction:column; padding:20px; overflow:auto; }

  /* Topbar */
  .topbar { display:flex; justify-content:space-between; align-items:center; margin-bottom:20px; }
  .topbar h2 { font-size:1.5em; }
  .topbar button { padding:6px 12px; border:none; background:#e63946; color:white; border-radius:5px; cursor:pointer; }
  .topbar button:hover { background:#d62828; }

  /* Cards */
  .cards { display:flex; gap:15px; margin-bottom:20px; }
  .card { flex:1; background:white; padding:20px; border-radius:8px; box-shadow:0 2px 5px rgba(0,0,0,0.1); text-align:center; }
  .card h3 { margin-bottom:10px; color:#1d3557; }
  .liveCard { border-top:4px solid #2a9d8f; }
  .downCard { border-top:4px solid #e63946; }

  /* Controls */
  .controls { display:flex; align-items:center; gap:10px; flex-wrap:wrap; margin-bottom:20px; }
  #adminTools { display:none; gap:10px; flex-wrap:wrap; }
  #adminTools input, #adminTools select, .controls select, .controls input[type="text"], #adminTools button {
    padding:6px 10px; border:1px solid #ccc; border-radius:4px; font-size:0.9em;
  }
  #adminTools button { background:#1d3557; color:white; border:none; cursor:pointer; }
  #adminTools button:hover { background:#457b9d; }

  /* Table */
  .tableBox { overflow:auto; background:white; border-radius:8px; padding:10px; box-shadow:0 2px 5px rgba(0,0,0,0.1); }
  table { width:100%; border-collapse:collapse; }
  th, td { text-align:left; padding:10px; border-bottom:1px solid #ddd; }
  th { background:#f1f1f1; }
  td input, td select { width:100%; padding:4px; }

  td button { padding:4px 8px; border:none; background:#e63946; color:white; border-radius:4px; cursor:pointer; }
  td button:hover { background:#d62828; }

  /* Status Colors */
  td[id^="status-"].live { color:#2a9d8f; font-weight:bold; text-transform:uppercase; }
  td[id^="status-"].down { color:#e63946; font-weight:bold; text-transform:uppercase; }

  /* Responsive */
  @media(max-width:800px){
    #dashboard { flex-direction:column; }
    .sidebar { width:100%; display:flex; flex-direction:row; justify-content:space-around; }
    .main { padding:10px; }
    .cards { flex-direction:column; }
  }
</style>
</head>
<body>

<div id="dashboard">
  <div class="sidebar">
    <h2>TrataSoft</h2>
    <ul>
      <li id="monBtn" class="active">View Monitoring</li>
      <li id="editBtn">Settings / Edit</li>
    </ul>
  </div>

  <div class="main">
    <div class="topbar">
      <h2 id="viewTitle">Live Monitoring</h2>
      <button id="logoutBtn">Logout</button>
    </div>

    <div class="cards">
      <div class="card"><h3>Total Sites</h3><p id="totalCount">0</p></div>
      <div class="card liveCard"><h3>Live</h3><p id="liveCount">0</p></div>
      <div class="card downCard"><h3>Down</h3><p id="downCount">0</p></div>
    </div>

    <div class="controls">
      <div id="adminTools">
        <input type="text" id="newName" placeholder="Company Name">
        <input type="text" id="newUrl" placeholder="Website URL">
        <select id="newNetwork">
          <option value="">Select Network Type</option>
          <option value="LAN">LAN</option>
          <option value="Wi-Fi">Wi-Fi</option>
          <option value="COFE CF-4G007e">COFE CF-4G007e</option>
        </select>
        <button id="addBtn">Add New</button>
      </div>

      <select id="filter">
        <option value="all">Filter: All</option>
        <option value="live">Live</option>
        <option value="down">Down</option>
      </select>
      <input type="text" id="search" placeholder="Search site...">
    </div>

    <div class="tableBox">
      <table>
        <thead>
          <tr>
            <th>Company</th>
            <th>Website</th>
            <th>Network</th>
            <th>Status</th>
            <th id="actionHeader" style="display:none;">Action</th>
          </tr>
        </thead>
        <tbody id="websiteTable"></tbody>
      </table>
    </div>
  </div>
</div>

<script type="module">
// ==== Firebase SDK ====
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-app.js";
import { getDatabase, ref, get, set } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-database.js";

const firebaseConfig = {
  apiKey:"AIzaSyC1I7uggV3I8Z7pmbpWQmJZO_mHlWQ7qRc",
  authDomain:"aitdata-1f856.firebaseapp.com",
  databaseURL:"https://aitdata-1f856-default-rtdb.firebaseio.com",
  projectId:"aitdata-1f856",
  storageBucket:"aitdata-1f856.firebasestorage.app",
  messagingSenderId:"535350785851",
  appId:"1:535350785851:web:67abe23a6da1dca7fe291e",
  measurementId:"G-82Y1DL677C"
};

const app = initializeApp(firebaseConfig);
const db = getDatabase(app);
const dbRef = ref(db,"websiteData");

// ==== Local Storage Login check ====
if(localStorage.getItem("loggedIn")!=="true") window.location.href="index.html";

let websites = [];
let isEditMode = false;

// ==== Load Websites from Firebase ====
async function loadWebsites(){
  const snapshot = await get(dbRef);
  if(snapshot.exists()) websites = Object.values(snapshot.val());
  else {
    for(let i=1;i<=700;i++){
      let num=i.toString().padStart(3,'0');
      websites.push({name:"TrataSoft "+num,url:"https://trtdlaita"+num+".tratasoft.com/login",status:"checking",networkType:"LAN"});
    }
    saveData();
  }
  initDashboard();
}

// ==== Save Data to Firebase ====
function saveData(){
  const updates={}; websites.forEach((s,i)=>updates[i]=s);
  set(dbRef,updates).catch(e=>alert(e));
}

loadWebsites();

// ==== Initialize Dashboard ====
function initDashboard(){
  const monBtn=document.getElementById("monBtn");
  const editBtn=document.getElementById("editBtn");
  const logoutBtn=document.getElementById("logoutBtn");
  const addBtn=document.getElementById("addBtn");
  const filter=document.getElementById("filter");
  const search=document.getElementById("search");

  monBtn.onclick=()=>toggleView('monitor');
  editBtn.onclick=()=>toggleView('edit');
  logoutBtn.onclick=()=>{localStorage.removeItem("loggedIn"); window.location.href="index.html";};
  addBtn.onclick=addWebsite;
  filter.onchange=renderTable;
  search.onkeyup=renderTable;

  function toggleView(mode){
    isEditMode=(mode==='edit');
    document.getElementById('adminTools').style.display=isEditMode?"block":"none";
    document.getElementById('actionHeader').style.display=isEditMode?"table-cell":"none";
    document.getElementById('viewTitle').innerText=isEditMode?"Management Mode":"Live Monitoring";
    editBtn.classList.toggle('active',isEditMode);
    monBtn.classList.toggle('active',!isEditMode);
    renderTable();
  }

  function addWebsite(){
    const name=document.getElementById("newName").value;
    const url=document.getElementById("newUrl").value;
    const network=document.getElementById("newNetwork").value;
    if(!name||!url||!network)return alert("Fill all fields");
    websites.push({name,url,status:"checking",networkType:network});
    saveData();
    document.getElementById("newName").value="";
    document.getElementById("newUrl").value="";
    document.getElementById("newNetwork").value="";
    renderTable();
  }

  window.deleteWebsite=function(index){
    if(confirm("Delete this entry?")){
      websites.splice(index,1);
      saveData();
      renderTable();
    }
  }

  function renderTable(){
    const f=filter.value, s=search.value.toLowerCase(), tbody=document.getElementById("websiteTable");
    tbody.innerHTML="";
    websites.forEach((site,i)=>{
      if(f!=="all" && site.status!==f) return;
      if(!site.name.toLowerCase().includes(s) && !site.url.toLowerCase().includes(s)) return;

      const row=document.createElement("tr");

      const nameCell=document.createElement("td");
      if(isEditMode){
        const input=document.createElement("input"); input.value=site.name;
        input.onchange=()=>{websites[i].name=input.value; saveData();}
        nameCell.appendChild(input);
      } else nameCell.innerText=site.name;

      const urlCell=document.createElement("td");
      if(isEditMode){
        const input=document.createElement("input"); input.value=site.url;
        input.onchange=()=>{websites[i].url=input.value; saveData();}
        urlCell.appendChild(input);
      } else { const a=document.createElement("a"); a.href=site.url; a.target="_blank"; a.innerText=site.url; urlCell.appendChild(a); }

      const networkCell=document.createElement("td");
      if(isEditMode){
        const select=document.createElement("select");
        ["LAN","Wi-Fi","COFE CF-4G007e"].forEach(opt=>{
          const o=document.createElement("option"); o.value=opt; o.text=opt;
          if(site.networkType===opt) o.selected=true;
          select.appendChild(o);
        });
        select.onchange=()=>{websites[i].networkType=select.value; saveData();}
        networkCell.appendChild(select);
      } else networkCell.innerText=site.networkType;

      const statusCell=document.createElement("td");
      statusCell.id="status-"+i;
      statusCell.innerText=site.status.toUpperCase();
      statusCell.classList.remove("live","down");
      if(site.status==="live") statusCell.classList.add("live");
      if(site.status==="down") statusCell.classList.add("down");

      const actionCell=document.createElement("td"); actionCell.style.display=isEditMode?"table-cell":"none";
      if(isEditMode){ const btn=document.createElement("button"); btn.innerText="Delete"; btn.onclick=()=>deleteWebsite(i); actionCell.appendChild(btn); }

      row.appendChild(nameCell); row.appendChild(urlCell); row.appendChild(networkCell); row.appendChild(statusCell); row.appendChild(actionCell);
      tbody.appendChild(row);

      checkStatus(site.url,i);
    });
    updateCounters();
  }

  function updateCounters(){
    const liveCount = websites.filter(s=>s.status==="live").length;
    const downCount = websites.filter(s=>s.status==="down").length;
    document.getElementById("totalCount").innerText = websites.length;
    document.getElementById("liveCount").innerText = liveCount;
    document.getElementById("downCount").innerText = downCount;

    // Optional: dynamically color card numbers
    document.querySelector(".liveCard p").style.color = liveCount>0?"#2a9d8f":"#555";
    document.querySelector(".downCard p").style.color = downCount>0?"#e63946":"#555";
  }

  function checkStatus(url,i){
    fetch(url, { mode:'no-cors' })
      .then(()=>{
        websites[i].status="live";
        const c=document.getElementById("status-"+i);
        if(c){ c.innerText="LIVE"; c.classList.add("live"); c.classList.remove("down"); }
      })
      .catch(()=>{
        websites[i].status="down";
        const c=document.getElementById("status-"+i);
        if(c){ c.innerText="DOWN"; c.classList.add("down"); c.classList.remove("live"); }
      });
  }

  setInterval(()=>{websites.forEach((site,i)=>checkStatus(site.url,i)); updateCounters();},30000);

}
</script>

</body>
</html>
