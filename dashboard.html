<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>TrataSoft Dashboard</title>
<link rel="stylesheet" href="style.css">
<style>
  /* Basic styling for demo */
  body { font-family: 'Segoe UI', sans-serif; margin: 0; background: #f4f6f9; }
  #dashboard { display: flex; height: 100vh; }
  .sidebar { width: 220px; background: #1d3557; color: #fff; padding: 20px; }
  .sidebar h2 { margin-bottom: 20px; }
  .sidebar ul { list-style: none; padding: 0; }
  .sidebar ul li { margin: 10px 0; cursor: pointer; }
  .sidebar ul li.active { font-weight: bold; }
  .main { flex: 1; padding: 20px; overflow-y: auto; }
  .topbar { display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px; }
  .cards { display: flex; gap: 15px; margin-bottom: 20px; }
  .card { background: #fff; padding: 15px; flex: 1; text-align: center; border-radius: 8px; box-shadow: 0 0 5px #ccc; }
  .controls { margin-bottom: 20px; }
  input, select, button { padding: 5px; margin-right: 5px; }
  table { width: 100%; border-collapse: collapse; background: #fff; }
  th, td { padding: 10px; border: 1px solid #ccc; text-align: left; }
  th { background: #eee; }
  .logout { padding: 5px 10px; background: #e63946; color: #fff; border: none; cursor: pointer; border-radius: 4px; }
</style>
</head>
<body>

<div id="dashboard">
    <div class="sidebar">
        <h2>TrataSoft</h2>
        <ul>
            <li id="monBtn" class="active" onclick="toggleView('monitor')">View Monitoring</li>
            <li id="editBtn" onclick="toggleView('edit')">Settings / Edit</li>
        </ul>
    </div>

    <div class="main">
        <div class="topbar">
            <h2 id="viewTitle">Live Monitoring</h2>
            <button class="logout" id="logoutBtn">Logout</button>
        </div>

        <div class="cards">
            <div class="card"><h3>Total Sites</h3><p id="totalCount">0</p></div>
            <div class="card liveCard"><h3>Live</h3><p id="liveCount">0</p></div>
            <div class="card downCard"><h3>Down</h3><p id="downCount">0</p></div>
        </div>

        <div class="controls">
            <div id="adminTools" style="display:none;">
                <input type="text" id="newName" placeholder="Company Name">
                <input type="text" id="newUrl" placeholder="Website URL">
                <select id="newNetwork">
                    <option value="">Select Network Type</option>
                    <option value="LAN">LAN</option>
                    <option value="Wi-Fi">Wi-Fi</option>
                    <option value="COFE CF-4G007e">COFE CF-4G007e</option>
                </select>
                <button id="addBtn">Add New</button>
            </div>
        </div>

        <div class="tableBox">
            <table>
                <thead>
                    <tr>
                        <th>Company</th>
                        <th>Website</th>
                        <th>Network</th>
                        <th>Status</th>
                        <th id="actionHeader" style="display:none;">Action</th>
                    </tr>
                </thead>
                <tbody id="websiteTable"></tbody>
            </table>
        </div>
    </div>
</div>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
import { 
  getFirestore, 
  collection, 
  addDoc, 
  getDocs, 
  deleteDoc, 
  doc 
} from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

/* ðŸ”¥ Firebase Config */
const firebaseConfig = {
  apiKey: "AIzaSyDKtHixAqtV7mt3rLG6O40cD5sag_PPT-4",
  authDomain: "aitdata.firebaseapp.com",
  projectId: "aitdata",
  storageBucket: "aitdata.firebasestorage.app",
  messagingSenderId: "1086041126338",
  appId: "1:1086041126338:web:71fdfaa5ff41218ec1525b"
};

const app = initializeApp(firebaseConfig);
const db = getFirestore(app);

let websites = [];
let isEditMode = false;

/* ðŸ” Login Check */
if(localStorage.getItem("loggedIn") !== "true") {
    window.location.href = "index.html";
}

/* Logout */
document.getElementById("logoutBtn").addEventListener("click", () => {
    localStorage.removeItem("loggedIn");
    window.location.href = "index.html";
});

/* Load Websites */
async function loadWebsites() {
    websites = [];
    const snapshot = await getDocs(collection(db, "websites"));
    snapshot.forEach(docSnap => {
        websites.push({ id: docSnap.id, ...docSnap.data() });
    });
    renderTable();
}

/* Add Website */
document.getElementById("addBtn").addEventListener("click", async () => {
    const name = document.getElementById("newName").value;
    const url = document.getElementById("newUrl").value;
    const network = document.getElementById("newNetwork").value;

    if(!name || !url || !network) return alert("Fill all fields");

    await addDoc(collection(db, "websites"), {
        name,
        url,
        networkType: network,
        status: "checking"
    });

    document.getElementById("newName").value = "";
    document.getElementById("newUrl").value = "";
    document.getElementById("newNetwork").value = "";

    loadWebsites();
});

/* Delete Website */
window.deleteWebsite = async function(id) {
    if(confirm("Delete this entry?")) {
        await deleteDoc(doc(db, "websites", id));
        loadWebsites();
    }
};

/* Toggle Mode */
window.toggleView = function(mode) {
    isEditMode = (mode === 'edit');
    document.getElementById('adminTools').style.display = isEditMode ? "block" : "none";
    document.getElementById('actionHeader').style.display = isEditMode ? "table-cell" : "none";
    document.getElementById('viewTitle').innerText = isEditMode ? "Management Mode" : "Live Monitoring";
    renderTable();
};

/* Render Table */
function renderTable() {
    const tableBody = document.getElementById("websiteTable");
    tableBody.innerHTML = "";

    let liveCount = 0;
    let downCount = 0;

    websites.forEach(site => {
        const row = document.createElement("tr");
        row.innerHTML = `
            <td>${site.name}</td>
            <td><a href="${site.url}" target="_blank">${site.url}</a></td>
            <td>${site.networkType}</td>
            <td id="status-${site.id}">${site.status || "checking"}</td>
            ${isEditMode ? `<td><button onclick="deleteWebsite('${site.id}')">Delete</button></td>` : ""}
        `;
        tableBody.appendChild(row);
        checkStatus(site.url, site.id);
    });

    updateCounters();
}

/* Check Website Status */
function checkStatus(url, id) {
    fetch(url, { mode: 'no-cors' })
    .then(() => {
        document.getElementById("status-"+id).innerText = "LIVE";
    })
    .catch(() => {
        document.getElementById("status-"+id).innerText = "DOWN";
    });
}

/* Update Counters */
function updateCounters() {
    const total = websites.length;
    let live = 0;
    let down = 0;
    websites.forEach(site => {
        const statusEl = document.getElementById("status-"+site.id);
        if(statusEl && statusEl.innerText === "LIVE") live++;
        if(statusEl && statusEl.innerText === "DOWN") down++;
    });

    document.getElementById("totalCount").innerText = total;
    document.getElementById("liveCount").innerText = live;
    document.getElementById("downCount").innerText = down;
}

/* Auto Refresh */
setInterval(loadWebsites, 30000);

/* Start */
loadWebsites();
</script>

</body>
</html>
