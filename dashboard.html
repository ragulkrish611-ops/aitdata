<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>TrataSoft Dashboard</title>
<link rel="stylesheet" href="style.css">
</head>
<body>

<div id="dashboard">
    <div class="sidebar">
        <h2>TrataSoft</h2>
        <ul>
            <li id="monBtn" class="active" onclick="toggleView('monitor')">View Monitoring</li>
            <li id="editBtn" onclick="toggleView('edit')">Settings / Edit</li>
        </ul>
    </div>

    <div class="main">
        <div class="topbar">
            <h2 id="viewTitle">Live Monitoring</h2>
            <button class="logout" onclick="logout()">Logout</button>
        </div>

        <div class="cards">
            <div class="card"><h3>Total Sites</h3><p id="totalCount">0</p></div>
            <div class="card liveCard"><h3>Live</h3><p id="liveCount">0</p></div>
            <div class="card downCard"><h3>Down</h3><p id="downCount">0</p></div>
        </div>

        <div class="controls">
            <div id="adminTools">
                <input type="text" id="newName" placeholder="Company Name">
                <input type="text" id="newUrl" placeholder="Website URL">
                <select id="newNetwork">
                    <option value="">Select Network Type</option>
                    <option value="LAN">LAN</option>
                    <option value="Wi-Fi">Wi-Fi</option>
                    <option value="COFE CF-4G007e">COFE CF-4G007e</option>
                </select>
                <button onclick="addWebsite()">Add New</button>
            </div>

            <select id="filter" onchange="renderTable()">
                <option value="all">Filter: All</option>
                <option value="live">Live</option>
                <option value="down">Down</option>
            </select>
            <input type="text" id="search" placeholder="Search site..." onkeyup="renderTable()">
        </div>

        <div class="tableBox">
            <table>
                <thead>
                    <tr>
                        <th>Company</th>
                        <th>Website</th>
                        <th>Network</th>
                        <th>Status</th>
                        <th id="actionHeader" style="display:none;">Action</th>
                    </tr>
                </thead>
                <tbody id="websiteTable"></tbody>
            </table>
        </div>
    </div>
</div>

<!-- Firebase SDK -->
<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-app.js";
import { getDatabase, ref, set, get } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-database.js";

const firebaseConfig = {
  apiKey: "AIzaSyC1I7uggV3I8Z7pmbpWQmJZO_mHlWQ7qRc",
  authDomain: "aitdata-1f856.firebaseapp.com",
  databaseURL: "https://aitdata-1f856-default-rtdb.firebaseio.com",
  projectId: "aitdata-1f856",
  storageBucket: "aitdata-1f856.firebasestorage.app",
  messagingSenderId: "535350785851",
  appId: "1:535350785851:web:67abe23a6da1dca7fe291e",
  measurementId: "G-82Y1DL677C"
};

const app = initializeApp(firebaseConfig);
const db = getDatabase(app);
const dbRef = ref(db, "websiteData");

if(localStorage.getItem("loggedIn") !== "true") window.location.href = "index.html";

let websites = [];
let isEditMode = false;

// Replace old localStorage logic with Firebase
async function loadWebsites() {
    try {
        const snapshot = await get(dbRef);
        if(snapshot.exists()){
            websites = Object.values(snapshot.val());
        } else {
            // First load: create 700 sites and save
            for(let i = 1; i <= 700; i++){
                let num = i.toString().padStart(3,'0');
                websites.push({
                    name: "TrataSoft " + num,
                    url: "https://trtdlaita" + num + ".tratasoft.com/login",
                    status: "checking",
                    networkType: "LAN"
                });
            }
            saveData();
        }
        renderTable();
    } catch(e) {
        console.error("Error loading Firebase data:", e);
    }
}
loadWebsites();

// Override saveData to write to Firebase
function saveData() {
    const updates = {};
    websites.forEach((site,index)=>{ updates[index] = site; });
    set(dbRef, updates)
      .then(()=>alert("Changes Saved Successfully!"))
      .catch(err=>alert("Firebase Save Error: " + err));
}

// Below this, keep ALL your old JS code exactly the same
// logout, toggleView, addWebsite, deleteWebsite, renderTable, checkStatus, etc.
// (your old script block can be pasted here, no changes)
</script>

<script>
// PASTE YOUR OLD SCRIPT CODE HERE
// All the JS logic you originally wrote, unchanged.
</script>

</body>
</html>
