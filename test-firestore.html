<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>TrataSoft Dashboard</title>
<style>
*{box-sizing:border-box;margin:0;padding:0;font-family:'Segoe UI',sans-serif;}
body{background:#f4f6f9;color:#333;}
#dashboard{display:flex;height:100vh;}
.sidebar{width:220px;background:#1d3557;color:#fff;padding:20px 10px;display:flex;flex-direction:column;}
.sidebar h2{text-align:center;margin-bottom:30px;}
.sidebar li{padding:10px;margin-bottom:10px;cursor:pointer;border-radius:5px;}
.sidebar li:hover,.sidebar li.active{background:#457b9d;}
.main{flex:1;padding:20px;overflow:auto;}
.topbar{display:flex;justify-content:space-between;margin-bottom:20px;}
.topbar button{padding:6px 12px;background:#e63946;color:#fff;border:none;border-radius:5px;cursor:pointer;}
.cards{display:flex;gap:15px;margin-bottom:20px;}
.card{flex:1;background:#fff;padding:20px;border-radius:8px;text-align:center;box-shadow:0 2px 5px rgba(0,0,0,0.1);}
.liveCard{border-top:4px solid #2a9d8f;}
.downCard{border-top:4px solid #e63946;}
.controls{display:flex;gap:10px;flex-wrap:wrap;margin-bottom:20px;}
#adminTools{display:none;gap:10px;}
input,select,button{padding:6px;border:1px solid #ccc;border-radius:4px;}
#adminTools button{background:#1d3557;color:#fff;border:none;}
table{width:100%;border-collapse:collapse;background:#fff;border-radius:8px;overflow:hidden;}
th,td{padding:10px;border-bottom:1px solid #ddd;}
th{background:#f1f1f1;}
.live{color:#2a9d8f;font-weight:bold;}
.down{color:#e63946;font-weight:bold;}
</style>
</head>
<body>

<div id="dashboard">
<div class="sidebar">
<h2>TrataSoft</h2>
<ul>
<li id="monBtn" class="active">View Monitoring</li>
<li id="editBtn">Settings / Edit</li>
</ul>
</div>

<div class="main">
<div class="topbar">
<h2 id="viewTitle">Live Monitoring</h2>
<button id="logoutBtn">Logout</button>
</div>

<div class="cards">
<div class="card"><h3>Total</h3><p id="totalCount">0</p></div>
<div class="card liveCard"><h3>Live</h3><p id="liveCount">0</p></div>
<div class="card downCard"><h3>Down</h3><p id="downCount">0</p></div>
</div>

<div class="controls">
<div id="adminTools">
<input id="newName" placeholder="Company">
<input id="newUrl" placeholder="Website URL">
<select id="newNetwork">
<option value="">Network</option>
<option>LAN</option>
<option>Wi-Fi</option>
<option>COFE CF-4G007e</option>
</select>
<button id="addBtn">Add</button>
<button id="saveBtn">Save</button>
</div>

<select id="filter">
<option value="all">All</option>
<option value="live">Live</option>
<option value="down">Down</option>
</select>

<input id="search" placeholder="Search">
</div>

<table>
<thead>
<tr>
<th>Company</th>
<th>Website</th>
<th>Network</th>
<th>Status</th>
<th id="actionHeader" style="display:none;">Action</th>
</tr>
</thead>
<tbody id="websiteTable"></tbody>
</table>

</div>
</div>

<script type="module">

import { initializeApp } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-app.js";
import { getDatabase, ref, set, onValue } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-database.js";

const firebaseConfig = {
apiKey:"AIzaSyDKtHixAqtV7mt3rLG6O40cD5sag_PPT-4",
authDomain:"aitdata.firebaseapp.com",
databaseURL:"https://aitdata-default-rtdb.firebaseio.com",
projectId:"aitdata",
storageBucket:"aitdata.firebasestorage.app",
messagingSenderId:"1086041126338",
appId:"1:1086041126338:web:71fdfaa5ff41218ec1525b"
};

const app = initializeApp(firebaseConfig);
const db = getDatabase(app);
const dbRef = ref(db,"websiteData");

if(localStorage.getItem("loggedIn")!=="true")
window.location.href="index.html";

let websites=[];
let isEditMode=false;

// ðŸ”¥ Auto Create Database + Realtime Listener
onValue(dbRef,(snapshot)=>{
if(snapshot.exists()){
websites=Object.values(snapshot.val());
renderTable();
}else{
const defaultData={};
for(let i=1;i<=700;i++){
let num=i.toString().padStart(3,'0');
defaultData[i]={
name:"TrataSoft "+num,
url:"https://trtdlaita"+num+".tratasoft.com/login",
status:"checking",
networkType:"LAN"
};
}
set(dbRef,defaultData);
}
});

// Save
function saveData(){
const obj={};
websites.forEach((s,i)=>obj[i]=s);
set(dbRef,obj);
}

// Add
document.getElementById("addBtn").onclick=()=>{
const name=newName.value;
const url=newUrl.value;
const network=newNetwork.value;
if(!name||!url||!network) return alert("Fill all fields");
websites.push({name,url,status:"checking",networkType:network});
saveData();
newName.value="";newUrl.value="";newNetwork.value="";
};

// Toggle
editBtn.onclick=()=>toggleView(true);
monBtn.onclick=()=>toggleView(false);

function toggleView(edit){
isEditMode=edit;
adminTools.style.display=edit?"flex":"none";
actionHeader.style.display=edit?"table-cell":"none";
editBtn.classList.toggle("active",edit);
monBtn.classList.toggle("active",!edit);
renderTable();
}

// Delete
window.deleteWebsite=(i)=>{
if(confirm("Delete?")){
websites.splice(i,1);
saveData();
}
};

// Render
function renderTable(){
const tbody=websiteTable;
tbody.innerHTML="";
const f=filter.value;
const s=search.value.toLowerCase();

websites.forEach((site,i)=>{
if(f!=="all"&&site.status!==f)return;
if(!site.name.toLowerCase().includes(s)&&!site.url.toLowerCase().includes(s))return;

const row=document.createElement("tr");

row.innerHTML=`
<td>${isEditMode?`<input value="${site.name}">`:site.name}</td>
<td>${isEditMode?`<input value="${site.url}">`:`<a href="${site.url}" target="_blank">${site.url}</a>`}</td>
<td>${isEditMode?`
<select>
<option ${site.networkType==="LAN"?"selected":""}>LAN</option>
<option ${site.networkType==="Wi-Fi"?"selected":""}>Wi-Fi</option>
<option ${site.networkType==="COFE CF-4G007e"?"selected":""}>COFE CF-4G007e</option>
</select>`:site.networkType}</td>
<td class="${site.status}">${site.status.toUpperCase()}</td>
<td style="display:${isEditMode?"table-cell":"none"}">
<button onclick="deleteWebsite(${i})">Delete</button>
</td>
`;

tbody.appendChild(row);
checkStatus(site.url,i);
});

updateCounters();
}

// Status Check + Save to DB
function checkStatus(url,i){
fetch(url,{mode:"no-cors"})
.then(()=>{
if(websites[i].status!=="live"){
websites[i].status="live";
saveData();
}
})
.catch(()=>{
if(websites[i].status!=="down"){
websites[i].status="down";
saveData();
}
});
}

function updateCounters(){
totalCount.innerText=websites.length;
liveCount.innerText=websites.filter(s=>s.status==="live").length;
downCount.innerText=websites.filter(s=>s.status==="down").length;
}

setInterval(()=>websites.forEach((s,i)=>checkStatus(s.url,i)),30000);

logoutBtn.onclick=()=>{
localStorage.removeItem("loggedIn");
window.location.href="index.html";
};

</script>
</body>
</html>
