<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>TrataSoft - Service Monitoring Dashboard</title>

<style>
* { margin: 0; padding: 0; box-sizing: border-box; }

body {
  font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
  background: #f8fafc;
  color: #1e293b;
  padding: 24px;
}

.container { max-width: 1400px; margin: 0 auto; }

.header {
  background: white;
  padding: 24px 32px;
  border-radius: 12px;
  box-shadow: 0 1px 3px rgba(0,0,0,0.1);
  margin-bottom: 32px;
  border-bottom: 3px solid #3b82f6;
}

.header h1 { font-size: 1.75rem; font-weight: 600; color: #1e293b; margin-bottom: 4px; }
.header p { color: #64748b; font-size: 0.95rem; }

.controls {
  background: white;
  padding: 20px 32px;
  border-radius: 12px;
  box-shadow: 0 1px 3px rgba(0,0,0,0.1);
  margin-bottom: 32px;
  display: flex;
  gap: 16px;
  align-items: center;
  flex-wrap: wrap;
}

.filter-group { display: flex; gap: 8px; align-items: center; }
.filter-label { font-weight: 500; color: #374151; font-size: 0.9rem; }
#statusFilter {
  padding: 8px 12px;
  border: 1px solid #d1d5db;
  border-radius: 6px;
  background: white;
  font-size: 0.9rem;
  min-width: 120px;
}

.stats-grid {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(240px, 1fr));
  gap: 20px;
  margin-bottom: 32px;
}

.stat-card {
  background: white;
  padding: 24px;
  border-radius: 12px;
  text-align: center;
  box-shadow: 0 4px 6px -1px rgba(0,0,0,0.1);
  border-left: 4px solid;
}

.total { border-left-color: #3b82f6; }
.live { border-left-color: #10b981; }
.down { border-left-color: #ef4444; }

.stat-label {
  font-size: 0.875rem;
  font-weight: 500;
  color: #64748b;
  text-transform: uppercase;
  margin-bottom: 8px;
}

.stat-number {
  font-size: 2rem;
  font-weight: 700;
  color: #1e293b;
}

.status-table {
  background: white;
  border-radius: 12px;
  overflow: hidden;
  box-shadow: 0 4px 6px -1px rgba(0,0,0,0.1);
  position: relative;
  min-height: 400px;
}

.loading, .error, .no-data {
  position: absolute;
  top: 50%;
  left: 50%;
  transform: translate(-50%, -50%);
  text-align: center;
  color: #64748b;
}

.error { color: #991b1b; }
.no-data { font-style: italic; }

table { width: 100%; border-collapse: collapse; }
.table-header { background: #f8fafc; border-bottom: 1px solid #e2e8f0; }

th { padding: 16px 20px; font-weight: 600; font-size: 0.875rem; color: #374151; text-transform: uppercase; }
td { padding: 16px 20px; border-bottom: 1px solid #f1f5f9; vertical-align: middle; }

tr:hover { background: #f8fafc; }
.company-name { font-weight: 600; color: #1e293b; }
.website-link { 
  color: #3b82f6; 
  text-decoration: none; 
  font-weight: 500; 
}
.website-link:hover { color: #2563eb; text-decoration: underline; }

.network-badge {
  display: inline-block;
  padding: 4px 12px;
  border-radius: 6px;
  font-size: 0.75rem;
  background: #f1f5f9;
  color: #64748b;
}

.status-badge {
  padding: 6px 12px;
  border-radius: 6px;
  font-size: 0.75rem;
  font-weight: 600;
  text-transform: uppercase;
}

.status-live { background: #dcfce7; color: #166534; }
.status-down { background: #fee2e2; color: #991b1b; }

.last-updated {
  text-align: center;
  color: #64748b;
  font-size: 0.875rem;
  margin-top: 24px;
}

@media (max-width: 768px) {
  body { padding: 16px; }
  .stats-grid { grid-template-columns: repeat(2, 1fr); }
}
</style>
</head>
<body>
<div class="container">
  <div class="header">
    <h1>Service Monitoring Dashboard</h1>
    <p>Real-time status overview for service operations</p>
  </div>

  <div class="controls">
    <div class="filter-group">
      <label for="statusFilter" class="filter-label">Filter:</label>
      <select id="statusFilter">
        <option value="all">All Services</option>
        <option value="live">Live Only</option>
        <option value="down">Down Only</option>
      </select>
    </div>
  </div>

  <div class="stats-grid">
    <div class="stat-card total">
      <div class="stat-label">Total Services</div>
      <div class="stat-number" id="total">0</div>
    </div>
    <div class="stat-card live">
      <div class="stat-label">Live Services</div>
      <div class="stat-number" id="live">0</div>
    </div>
    <div class="stat-card down">
      <div class="stat-label">Down Services</div>
      <div class="stat-number" id="down">0</div>
    </div>
  </div>

  <div class="status-table" id="tableContainer">
    <div class="loading" id="loadingMsg">Connecting to database...</div>
    <table style="display: none;">
      <thead class="table-header">
        <tr>
          <th>Company</th>
          <th>Website</th>
          <th>Network</th>
          <th>Status</th>
        </tr>
      </thead>
      <tbody id="tableBody"></tbody>
    </table>
  </div>

  <div class="last-updated" id="lastUpdated"></div>
</div>

<script type="module">
  // Your Firebase config with databaseURL added
  const firebaseConfig = {
    apiKey: "AIzaSyDKtHixAqtV7mt3rLG6O40cD5sag_PPT-4",
    authDomain: "aitdata.firebaseapp.com",
    databaseURL: "https://aitdata-default-rtdb.asia-south1.firebasedatabase.app/",
    projectId: "aitdata",
    storageBucket: "aitdata.firebasestorage.app",
    messagingSenderId: "1086041126338",
    appId: "1:1086041126338:web:71fdfaa5ff41218ec1525b"
  };

  // Import Firebase
  import('https://www.gstatic.com/firebasejs/10.8.0/firebase-app.js').then(async ({ initializeApp }) => {
    import('https://www.gstatic.com/firebasejs/10.8.0/firebase-database.js').then(async ({ getDatabase, ref, onValue }) => {
      
      try {
        const app = initializeApp(firebaseConfig);
        const db = getDatabase(app);
        const dbRef = ref(db, "websiteData");
        
        let allWebsites = [];
        const statusFilter = document.getElementById('statusFilter');
        
        onValue(dbRef, (snapshot) => {
          const data = snapshot.val();
          document.getElementById('loadingMsg').style.display = 'none';
          document.querySelector('table').style.display = 'table';
          
          if (!data) {
            showMessage('No data found. Add data to "websiteData" in Firebase.', 'error');
            return;
          }
          
          allWebsites = Object.values(data);
          render(allWebsites, statusFilter.value);
          updateTimestamp();
          
        }, (error) => {
          console.error('Firebase Error:', error);
          showMessage('Database access denied. Check Firebase rules.', 'error');
        });
        
        statusFilter.addEventListener('change', (e) => {
          render(allWebsites, e.target.value);
        });
        
      } catch (error) {
        console.error('Init Error:', error);
        showMessage('Failed to connect to Firebase', 'error');
      }
    });
  });

  function render(websites, filter) {
    const tbody = document.getElementById('tableBody');
    tbody.innerHTML = '';
    
    let liveCount = 0, downCount = 0;
    const filtered = filter === 'all' ? websites : websites.filter(w => w.status === filter);
    
    if (filtered.length === 0) {
      showMessage('No services match this filter', 'no-data');
      return;
    }
    
    filtered.forEach(site => {
      const row = document.createElement('tr');
      const statusClass = site.status === 'live' ? 'status-live' : 'status-down';
      
      row.innerHTML = `
        <td class="company-name">${site.name || 'N/A'}</td>
        <td><a href="${site.url}" target="_blank" class="website-link">${site.url}</a></td>
        <td><span class="network-badge">${site.networkType || 'Unknown'}</span></td>
        <td><span class="status-badge ${statusClass}">${site.status?.toUpperCase()}</span></td>
      `;
      tbody.appendChild(row);
      
      if (site.status === 'live') liveCount++;
      if (site.status === 'down') downCount++;
    });
    
    document.getElementById('total').textContent = websites.length;
    document.getElementById('live').textContent = liveCount;
    document.getElementById('down').textContent = downCount;
  }
  
  function showMessage(msg, type) {
    const container = document.getElementById('tableContainer');
    container.innerHTML = `<div class="${type}">${msg}</div>`;
  }
  
  function updateTimestamp() {
    const now = new Date().toLocaleTimeString('en-IN', {
      hour: '2-digit',
      minute: '2-digit',
      second: '2-digit'
    });
    document.getElementById('lastUpdated').textContent = `Last updated: ${now}`;
  }
</script>
</body>
</html>
